<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>D3.js</title>
    <style>
        html {
            font-family: sans-serif;
        }

        #app {
            display: flex;
            margin: 2rem 1rem;
        }

        #chart {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.26);
            padding: 1rem;
        }

        #chart,
        #data {
            margin: 0 2rem;
        }

        #data ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        button {
            margin: 0 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            /*background-color: #4CAF50;*/
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        #data li {
            margin-bottom: 1rem;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.26);
            width: 10rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        .bar {
            fill: #4f009e;
        }

        .label {
            fill: #4f009e;
        }
    </style>
    <script src="https://d3js.org/d3.v7.min.js" defer></script>
    <script src="https://d3js.org/d3-scale.v3.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-axis@3"></script>

    <script src="app.js" defer></script>

</head>
<body>
<div id="app">
    <div id="chart">
        <svg id = "mySVG"></svg>
    </div>
    <div id="data">
        <ul></ul>
    </div>


</div>
<button onclick="download()">Download SVG</button>

<script>
    function download() {
    const svg = d3.select("svg");
    const chart = svg.select("g");
    // downloadSvg(chart.node(),'picture.png', 'PNG');
    downloadSvg();

    }
    // function downloadSvg(svgElement) {
    //     const svgXml = new XMLSerializer().serializeToString(svgElement);
    //     const svgBlob = new Blob([svgXml], { type: "image/svg+xml;charset=utf-8" });
    //     const svgUrl = URL.createObjectURL(svgBlob);
    //     const downloadLink = document.createElement("a");
    //     downloadLink.href = svgUrl;
    //     downloadLink.download = "chart.svg";
    //     document.body.appendChild(downloadLink);
    //     downloadLink.click();
    //     document.body.removeChild(downloadLink);
    // }
    // function downloadSvg(svg, filename, format) {
    //     console.log("downloading")
    //     let serializer = new XMLSerializer();
    //     let source = serializer.serializeToString(svg);
    //
    //     let canvas = document.createElement("canvas");
    //     let context = canvas.getContext("2d");
    //
    //     let image = new Image();
    //     image.onload = function () {
    //         canvas.width = image.width;
    //         canvas.height = image.height;
    //         context.drawImage(image, 0, 0);
    //
    //         let link = document.createElement("a");
    //         link.download = `${filename}.${format}`;
    //         link.href = canvas.toDataURL(`image/${format}`);
    //         link.click();
    //     };
    //
    //     let css = new XMLSerializer().serializeToString(document.querySelector("style"));
    //     let svgBlob = new Blob([css, source], { type: "image/svg+xml;charset=utf-8" });
    //     let url = URL.createObjectURL(svgBlob);
    //
    //     if (format === "pdf") {
    //         let doc = new jsPDF();
    //         doc.addImage(url, "SVG", 0, 0);
    //         doc.save(`${filename}.${format}`);
    //     } else if (format === "png") {
    //         image.src = url;
    //     }
    // }

    function downloadSvg() {
        const svg = document.querySelector("svg");
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");

        // Set canvas dimensions to match SVG element
        canvas.width = svg.width.baseVal.value;
        canvas.height = svg.height.baseVal.value;

        // Create a new image and load the SVG data URL
        const image = new Image();
        image.src = "data:image/svg+xml;base64," + btoa(new XMLSerializer().serializeToString(svg));

        // Wait for the image to load
        image.onload = function () {
            // Draw the image on the canvas
            context.drawImage(image, 0, 0);

            // Create a PNG data URL from the canvas
            const pngDataUrl = canvas.toDataURL("image/png");

            // Create a link element and click it to download the PNG file
            const link = document.createElement("a");
            link.download = "chart.png";
            link.href = pngDataUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };
    }


</script>
<div id="buttons">



</div>
</body>
</html>
